<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F1 Manager 2025 — Funcionários</title>

  <style>
    :root{
      --bg:#05050a;
      --panel: rgba(10,10,16,.82);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.72);

      --cyan:#40c4ff;
      --green:#00e676;
      --purple:#b388ff;
      --orange:#ff9100;
      --red:#ff1744;

      --radius:22px;
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; padding:0; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      background-image: url("assets/ui/lobby_bg.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
    }
    body::-webkit-scrollbar{ width:10px; }
    body::-webkit-scrollbar-track{ background: rgba(0,0,0,.25); }
    body::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.18);
      border-radius: 999px;
      border:2px solid rgba(0,0,0,.25);
    }

    .overlay{
      min-height:100vh;
      width:100%;
      background:
        radial-gradient(circle at 18% 12%, rgba(64,196,255,.10), rgba(0,0,0,0) 40%),
        radial-gradient(circle at 88% 20%, rgba(179,136,255,.10), rgba(0,0,0,0) 45%),
        linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.90));
      display:flex;
      flex-direction:column;
      padding: 14px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      width: min(1200px, 100%);
      margin: 0 auto;
    }
    .pillBtn{
      border:none; cursor:pointer;
      border-radius:999px;
      padding: 10px 16px;
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#fff;
      background: linear-gradient(135deg, rgba(255,23,68,.95), rgba(255,23,68,.62));
      box-shadow: 0 0 18px rgba(255,23,68,.45);
    }
    .title{
      flex:1;
      text-align:center;
      padding: 0 8px;
    }
    .title h1{
      margin:0;
      font-size:1.02rem;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .title p{
      margin:.35rem 0 0;
      color: var(--muted);
      font-size:.88rem;
      line-height:1.25;
    }

    .wrap{
      width: min(1200px, 100%);
      margin: 12px auto 40px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 980px){
      .wrap{ grid-template-columns: 1fr 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(12,12,20,.90), rgba(10,10,16,.74));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .cardHead{
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.28);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      font-size:.72rem;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }

    .cardBody{ padding: 14px; }

    .statGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .stat{
      padding: 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.30);
      border:1px solid rgba(255,255,255,.08);
    }
    .stat small{
      display:block;
      opacity:.72;
      font-size:.70rem;
      letter-spacing:.10em;
      text-transform:uppercase;
      margin-bottom:4px;
    }
    .stat strong{
      font-size:1.00rem;
      letter-spacing:.02em;
    }

    .roleBox{
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.30);
      border: 1px solid rgba(255,255,255,.10);
      margin-bottom: 10px;
    }
    .roleTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .roleName{
      margin:0;
      font-size:1rem;
      font-weight:900;
      letter-spacing:.02em;
    }
    .roleText{
      margin:6px 0 0;
      color: var(--muted);
      font-size:.88rem;
      line-height:1.32;
    }

    .chip{
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:.10em;
      font-size:.72rem;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      white-space:nowrap;
    }
    .chip.cyan{ border-color: rgba(64,196,255,.30); }
    .chip.green{ border-color: rgba(0,230,118,.30); }
    .chip.purple{ border-color: rgba(179,136,255,.30); }
    .chip.orange{ border-color: rgba(255,145,0,.30); }

    .btnRow{
      display:flex;
      gap:10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .btn{
      border:none; cursor:pointer;
      border-radius:999px;
      padding: 12px 14px;
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#fff;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
      flex:1;
      min-width: 180px;
      text-align:center;
    }
    .btn.green{ background: linear-gradient(135deg, rgba(0,230,118,.90), rgba(0,230,118,.52)); border-color: rgba(0,230,118,.34); }
    .btn.cyan{ background: linear-gradient(135deg, rgba(64,196,255,.90), rgba(64,196,255,.55)); border-color: rgba(64,196,255,.34); }
    .btn.purple{ background: linear-gradient(135deg, rgba(179,136,255,.90), rgba(179,136,255,.55)); border-color: rgba(179,136,255,.34); }
    .btn.red{ background: linear-gradient(135deg, rgba(255,23,68,.90), rgba(255,23,68,.55)); border-color: rgba(255,23,68,.34); }
    .btn:active{ transform: scale(.99); }

    .note{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.72);
      font-size:.86rem;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="overlay">

    <div class="topbar">
      <button class="pillBtn" id="btnBack">VOLTAR</button>
      <div class="title">
        <h1>FUNCIONÁRIOS & STAFF</h1>
        <p>Contrate especialistas e aumente desempenho: ritmo, desgaste, confiabilidade, pit e estratégia.</p>
      </div>
      <div style="width:110px;"></div>
    </div>

    <div class="wrap">

      <!-- ESQUERDA: ROSTER -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="badge">SEU STAFF</div>
            <div style="margin-top:6px; font-weight:900; letter-spacing:.02em;">Equipe contratada</div>
          </div>
          <div class="badge" id="teamBadge">EQUIPE</div>
        </div>

        <div class="cardBody">
          <div class="statGrid">
            <div class="stat"><small>Caixa</small><strong id="cashTxt">--</strong></div>
            <div class="stat"><small>Reputação</small><strong id="repTxt">--</strong></div>
            <div class="stat"><small>Mod Pace</small><strong id="mPace">--</strong></div>
            <div class="stat"><small>Mod Tire</small><strong id="mTire">--</strong></div>
            <div class="stat"><small>Mod Pit</small><strong id="mPit">--</strong></div>
            <div class="stat"><small>Mod Strat</small><strong id="mStrat">--</strong></div>
          </div>

          <div style="margin-top:12px;" id="rosterBox">
            <!-- roster via JS -->
          </div>

          <div class="note">
            <b>Impacto real no jogo:</b><br/>
            • Estes multiplicadores ficam gravados no save (offline).<br/>
            • Depois, você liga isso na simulação de corrida/treino — o efeito já está pronto para ser lido.
          </div>
        </div>
      </div>

      <!-- DIREITA: MERCADO -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="badge">MERCADO DE STAFF</div>
            <div style="margin-top:6px; font-weight:900; letter-spacing:.02em;">Contrate especialistas</div>
          </div>
          <div class="badge">SALÁRIO / SEMANA</div>
        </div>

        <div class="cardBody" id="marketBox">
          <!-- mercado via JS -->
        </div>
      </div>

    </div>
  </div>

  <script src="js/saveSystem.js"></script>
  <script src="js/gameData.js"></script>
  <script>
    const params = new URL(window.location.href).searchParams;
    const userTeam = (params.get("userTeam") || SaveSystem.load().profile.userTeam || "redbull").toLowerCase();

    const cashTxt = document.getElementById("cashTxt");
    const repTxt = document.getElementById("repTxt");
    const teamBadge = document.getElementById("teamBadge");

    const mPace = document.getElementById("mPace");
    const mTire = document.getElementById("mTire");
    const mPit = document.getElementById("mPit");
    const mStrat = document.getElementById("mStrat");

    const rosterBox = document.getElementById("rosterBox");
    const marketBox = document.getElementById("marketBox");

    function money(n){ return GameData.money(n); }

    function goLobby(){
      const url = new URL("lobby.html", window.location.href);
      url.searchParams.set("userTeam", userTeam);
      window.location.href = url.toString();
    }
    document.getElementById("btnBack").addEventListener("click", goLobby);

    const ROLE_LABEL = {
      technicalDirector: "Diretor Técnico",
      raceEngineer: "Engenheiro de Corrida",
      strategist: "Estrategista",
      aeroLead: "Chefe de Aerodinâmica",
      pitCrewChief: "Chefe do Pit Crew",
    };

    const ROLE_BADGE = {
      technicalDirector: "orange",
      raceEngineer: "cyan",
      strategist: "purple",
      aeroLead: "cyan",
      pitCrewChief: "green",
    };

    function refresh(){
      const save = SaveSystem.load();
      save.profile.userTeam = userTeam;
      SaveSystem.save(save);

      teamBadge.textContent = "EQUIPE: " + String(userTeam).toUpperCase();
      cashTxt.textContent = money(save.economy.cash || 0);
      repTxt.textContent = String(save.economy.reputation || 0);

      // recalcula modifiers sempre
      const mods = SaveSystem.computeStaffModifiers(save.staff.roster || {});
      SaveSystem.set("staff.teamModifiers", mods);

      mPace.textContent = mods.pace.toFixed(3);
      mTire.textContent = mods.tireWear.toFixed(3);
      mPit.textContent  = mods.pitSpeed.toFixed(3);
      mStrat.textContent= mods.strategy.toFixed(3);

      renderRoster(save);
      renderMarket(save);
    }

    function renderRoster(save){
      const r = save.staff.roster || {};
      rosterBox.innerHTML = "";

      Object.keys(ROLE_LABEL).forEach(role => {
        const person = r[role];

        const box = document.createElement("div");
        box.className = "roleBox";

        if(!person){
          box.innerHTML = `
            <div class="roleTop">
              <div>
                <p class="roleName" style="margin:0;">${ROLE_LABEL[role]}</p>
                <p class="roleText">Vaga aberta — contrate no mercado para melhorar desempenho.</p>
              </div>
              <div class="chip ${ROLE_BADGE[role] || ""}">VAZIO</div>
            </div>
          `;
        } else {
          box.innerHTML = `
            <div class="roleTop">
              <div>
                <p class="roleName" style="margin:0;">${ROLE_LABEL[role]} — ${person.name}</p>
                <p class="roleText">Rating: <b>${person.rating}</b> • Salário/semana: <b>${money(person.wageWeekly)}</b><br/>
                Especialidade: <b>${person.specialty || "—"}</b></p>
              </div>
              <div class="chip ${ROLE_BADGE[role] || ""}">ATIVO</div>
            </div>

            <div class="btnRow">
              <button class="btn red" data-fire="${role}">DEMITIR</button>
            </div>
          `;
        }

        rosterBox.appendChild(box);
      });

      rosterBox.querySelectorAll("button[data-fire]").forEach(btn => {
        btn.addEventListener("click", () => {
          const role = btn.getAttribute("data-fire");
          const ok = confirm("Deseja demitir este funcionário? (sem multa por enquanto)");
          if(!ok) return;

          SaveSystem.update(save => {
            save.staff.roster[role] = null;
          });

          refresh();
        });
      });
    }

    function renderMarket(save){
      marketBox.innerHTML = "";

      const rep = save.economy.reputation || 0;

      GameData.StaffMarket.forEach(p => {
        const roleLabel = ROLE_LABEL[p.role] || p.role;

        // pequeno gating por reputação (opcional)
        // aqui: rating alto exige reputação maior
        const needRep = Math.max(0, Math.floor((p.rating - 60) * 1.2)); // ex: 86 -> ~31
        const locked = rep < needRep;

        const item = document.createElement("div");
        item.className = "roleBox";
        item.innerHTML = `
          <div class="roleTop">
            <div>
              <p class="roleName">${p.name}</p>
              <p class="roleText">
                Cargo: <b>${roleLabel}</b><br/>
                Rating: <b>${p.rating}</b> • Salário/semana: <b>${money(p.wageWeekly)}</b><br/>
                Especialidade: <b>${p.specialty}</b>
              </p>
              ${locked ? `<p class="roleText" style="color:rgba(255,145,0,.95); font-weight:800;">Requer reputação ${needRep}+</p>` : ``}
            </div>
            <div class="chip ${ROLE_BADGE[p.role] || ""}">${p.role.toUpperCase()}</div>
          </div>

          <div class="btnRow">
            <button class="btn green" data-hire="${p.id}" ${locked ? "disabled style='opacity:.45; cursor:not-allowed;'" : ""}>
              CONTRATAR
            </button>
          </div>
        `;
        marketBox.appendChild(item);
      });

      marketBox.querySelectorAll("button[data-hire]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-hire");
          const cand = GameData.StaffMarket.find(x => x.id === id);
          if(!cand) return;

          const save = SaveSystem.load();
          const cash = save.economy.cash || 0;

          if (cash < cand.wageWeekly * 4) {
            alert("Caixa insuficiente. Recomendado ter pelo menos 4 semanas de salário em caixa.");
            return;
          }

          const ok = confirm(`Contratar ${cand.name} como ${ROLE_LABEL[cand.role]}?\nSalário semanal: ${money(cand.wageWeekly)}`);
          if(!ok) return;

          SaveSystem.update(s => {
            // substitui o atual do cargo
            s.staff.roster[cand.role] = {
              id: cand.id,
              role: cand.role,
              name: cand.name,
              rating: cand.rating,
              wageWeekly: cand.wageWeekly,
              specialty: cand.specialty,
              hiredAt: new Date().toISOString(),
            };

            // efeito imediato: paga 1 semana adiantado (bem simples)
            s.economy.cash = Math.max(0, Math.round((s.economy.cash || 0) - cand.wageWeekly));
          });

          refresh();
          alert("Contratado! (1 semana paga adiantado)");
        });
      });
    }

    refresh();
  </script>
</body>
</html>